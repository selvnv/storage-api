name: Simple Workflow
on:
 push:
  branches:
    - 'main'
    - 'dev'

jobs:

  build:
    runs-on: ubuntu-latest
    steps:
    - run: echo "üéâ The job was automatically triggered by a ${{ github.event_name }} event."
    # –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
    - uses: actions/checkout@v4
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Python
    - uses: actions/setup-python@v4

    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
    - name: install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install uv
        uv sync

    # –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
    - name: make migrations
      run: |
        python manage.py makemigrations
        python manage.py migrate

    # –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
    - name: run server
      run: |
        python manage.py runserver &
        sleep 10

    # –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
    - name: test api
      run: |
        curl -X GET http://127.0.0.1:8000/user/
        curl -X GET http://127.0.0.1:8000/user_role/